// Generated by CoffeeScript 2.7.0
var echo, range,
  indexOf = [].indexOf;

import {
  Edmonds
} from './blossom.js';

range = _.range;

echo = console.log;

export var FairPair = class FairPair {
  constructor(players, R, GAMES) {
    var edges, edmonds, i, j, k, len, magic, r, ref;
    this.players = players;
    this.R = R;
    this.GAMES = GAMES;
    this.N = this.players.length;
    //@players.sort (a,b) -> a.elo - b.elo
    echo(this.players);
    this.matrix = (function() {
      var k, len, ref, results;
      ref = range(this.N);
      results = [];
      for (k = 0, len = ref.length; k < len; k++) {
        j = ref[k];
        results.push((function() {
          var l, len1, ref1, results1;
          ref1 = range(this.N);
          results1 = [];
          for (l = 0, len1 = ref1.length; l < len1; l++) {
            i = ref1[l];
            results1.push("â€¢");
          }
          return results1;
        }).call(this));
      }
      return results;
    }).call(this);
    this.summa = 0;
    this.rounds = [];
    ref = range(this.R);
    for (k = 0, len = ref.length; k < len; k++) {
      r = ref[k];
      edges = this.makeEdges();
      edmonds = new Edmonds(edges);
      magic = edmonds.maxWeightMatching(edges);
      this.rounds.push(this.updatePlayers(magic, r));
    }
  }

  makeEdges() {
    var a, b, diff, edges, i, j, k, l, len, len1, ref, ref1;
    edges = [];
    ref = range(this.N);
    for (k = 0, len = ref.length; k < len; k++) {
      i = ref[k];
      a = this.players[i];
      ref1 = range(this.N);
      for (l = 0, len1 = ref1.length; l < len1; l++) {
        j = ref1[l];
        if (i === j) {
          this.matrix[i][j] = ' ';
        }
        b = this.players[j];
        diff = a.elo - b.elo;
        if (this.ok(a, b)) {
          edges.push([i, j, 10000 - diff ** 1.01]);
        }
      }
    }
    return edges;
  }

  // sortTables : (tables) -> # Blossom verkar redan ge en bra bordsplacering
  // 	tables.sort (x,y) -> y[2] - x[2]
  // 	table.slice 0,2 for table in tables
  updatePlayers(magic, r) {
    var a, b, i, id, j, k, len, tables;
    tables = [];
    for (k = 0, len = magic.length; k < len; k++) {
      id = magic[k];
      i = id;
      j = magic[id];
      // echo 'updateplayers',magic, r
      if (i === this.matrix.length || j === this.matrix[0].length) {
        continue;
      }
      this.matrix[i][j] = (r + 1).toString();
      if (i > j) {
        continue;
      }
      this.summa += Math.abs(this.players[i].elo - this.players[j].elo);
      a = this.players[i];
      b = this.players[j];
      a.opp.push(j);
      b.opp.push(i);
      if (a.balans() > b.balans()) {
        a.col += 'b';
        b.col += 'w';
        tables.push([
          j,
          i //, a.elo + b.elo]
        ]);
      } else {
        a.col += 'w';
        b.col += 'b';
        tables.push([
          i,
          j //, a.elo + b.elo]
        ]);
      }
    }
    
    //@sortTables tables
    //echo 'updatePlayers',tables
    return tables;
  }

  ok(a, b) {
    var ref;
    if (a.id === b.id) {
      return false;
    }
    if (ref = a.id, indexOf.call(b.opp, ref) >= 0) {
      return false;
    }
    if (this.GAMES % 2 === 0) {
      return true;
    }
    return Math.abs(a.balans() + b.balans()) < 2;
  }

};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFpcnBhaXIuanMiLCJzb3VyY2VSb290IjoiXFwiLCJzb3VyY2VzIjpbImZhaXJwYWlyLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsSUFBQSxJQUFBLEVBQUEsS0FBQTtFQUFBOztBQUFBLE9BQUE7RUFBUyxPQUFUO0NBQUEsTUFBQTs7QUFFQSxLQUFBLEdBQVEsQ0FBQyxDQUFDOztBQUNWLElBQUEsR0FBTyxPQUFPLENBQUM7O0FBRWYsT0FBQSxJQUFhLFdBQU4sTUFBQSxTQUFBO0VBQ04sV0FBYyxRQUFBLEdBQUEsT0FBQSxDQUFBO0FBQ2YsUUFBQSxLQUFBLEVBQUEsT0FBQSxFQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQSxLQUFBLEVBQUEsQ0FBQSxFQUFBO0lBRGdCLElBQUMsQ0FBQTtJQUFTLElBQUMsQ0FBQTtJQUFHLElBQUMsQ0FBQTtJQUM3QixJQUFDLENBQUEsQ0FBRCxHQUFLLElBQUMsQ0FBQSxPQUFPLENBQUMsT0FBaEI7O0lBRUUsSUFBQSxDQUFLLElBQUMsQ0FBQSxPQUFOO0lBQ0EsSUFBQyxDQUFBLE1BQUQ7O0FBQVc7QUFBQTtNQUFBLEtBQUEscUNBQUE7Ozs7QUFBQztBQUFBO1VBQUEsS0FBQSx3Q0FBQTs7MEJBQUE7VUFBQSxDQUFBOzs7TUFBRCxDQUFBOzs7SUFDWCxJQUFDLENBQUEsS0FBRCxHQUFTO0lBQ1QsSUFBQyxDQUFBLE1BQUQsR0FBVTtBQUVWO0lBQUEsS0FBQSxxQ0FBQTs7TUFDQyxLQUFBLEdBQVEsSUFBQyxDQUFBLFNBQUQsQ0FBQTtNQUNSLE9BQUEsR0FBVSxJQUFJLE9BQUosQ0FBWSxLQUFaO01BQ1YsS0FBQSxHQUFRLE9BQU8sQ0FBQyxpQkFBUixDQUEwQixLQUExQjtNQUNSLElBQUMsQ0FBQSxNQUFNLENBQUMsSUFBUixDQUFhLElBQUMsQ0FBQSxhQUFELENBQWUsS0FBZixFQUFxQixDQUFyQixDQUFiO0lBSkQ7RUFSYTs7RUFjZCxTQUFZLENBQUEsQ0FBQTtB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SUFBQyxDQUFBLEtBQUQsR0FBUyxDQUFULEtBQWMsQ0FBakI7QUFBd0IsYUFBTyxLQUEvQjs7V0FDQSxJQUFJLENBQUMsR0FBTCxDQUFTLENBQUMsQ0FBQyxNQUFGLENBQUEsQ0FBQSxHQUFhLENBQUMsQ0FBQyxNQUFGLENBQUEsQ0FBdEIsQ0FBQSxHQUFvQztFQUpoQzs7QUF6REMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFZG1vbmRzIH0gZnJvbSAnLi9ibG9zc29tLmpzJyAgXHJcblxyXG5yYW5nZSA9IF8ucmFuZ2VcclxuZWNobyA9IGNvbnNvbGUubG9nXHJcblxyXG5leHBvcnQgY2xhc3MgRmFpclBhaXIgXHJcblx0Y29uc3RydWN0b3IgOiAoQHBsYXllcnMsIEBSLCBAR0FNRVMpIC0+XHJcblx0XHRATiA9IEBwbGF5ZXJzLmxlbmd0aFxyXG5cdFx0I0BwbGF5ZXJzLnNvcnQgKGEsYikgLT4gYS5lbG8gLSBiLmVsb1xyXG5cdFx0ZWNobyBAcGxheWVyc1xyXG5cdFx0QG1hdHJpeCA9ICgoXCLigKJcIiBmb3IgaSBpbiByYW5nZSBATikgZm9yIGogaW4gcmFuZ2UgQE4pXHJcblx0XHRAc3VtbWEgPSAwXHJcblx0XHRAcm91bmRzID0gW11cclxuXHJcblx0XHRmb3IgciBpbiByYW5nZSBAUlxyXG5cdFx0XHRlZGdlcyA9IEBtYWtlRWRnZXMoKVxyXG5cdFx0XHRlZG1vbmRzID0gbmV3IEVkbW9uZHMgZWRnZXNcclxuXHRcdFx0bWFnaWMgPSBlZG1vbmRzLm1heFdlaWdodE1hdGNoaW5nIGVkZ2VzXHJcblx0XHRcdEByb3VuZHMucHVzaCBAdXBkYXRlUGxheWVycyBtYWdpYyxyXHJcblxyXG5cdG1ha2VFZGdlcyA6IC0+XHJcblx0XHRlZGdlcyA9IFtdIFxyXG5cdFx0Zm9yIGkgaW4gcmFuZ2UgQE5cclxuXHRcdFx0YSA9IEBwbGF5ZXJzW2ldXHJcblx0XHRcdGZvciBqIGluIHJhbmdlIEBOXHJcblx0XHRcdFx0aWYgaT09aiB0aGVuIEBtYXRyaXhbaV1bal0gPSAnICdcclxuXHRcdFx0XHRiID0gQHBsYXllcnNbal1cclxuXHRcdFx0XHRkaWZmID0gYS5lbG8gLSBiLmVsb1xyXG5cdFx0XHRcdGlmIEBvayBhLGIgdGhlbiBlZGdlcy5wdXNoIFtpLCBqLCAxMDAwMCAtIGRpZmYgKiogMS4wMV1cclxuXHRcdGVkZ2VzXHJcblxyXG5cdCMgc29ydFRhYmxlcyA6ICh0YWJsZXMpIC0+ICMgQmxvc3NvbSB2ZXJrYXIgcmVkYW4gZ2UgZW4gYnJhIGJvcmRzcGxhY2VyaW5nXHJcblx0IyBcdHRhYmxlcy5zb3J0ICh4LHkpIC0+IHlbMl0gLSB4WzJdXHJcblx0IyBcdHRhYmxlLnNsaWNlIDAsMiBmb3IgdGFibGUgaW4gdGFibGVzXHJcblxyXG5cdHVwZGF0ZVBsYXllcnMgOiAobWFnaWMscikgLT5cclxuXHRcdHRhYmxlcyA9IFtdXHJcblx0XHRmb3IgaWQgaW4gbWFnaWNcclxuXHRcdFx0aSA9IGlkXHJcblx0XHRcdGogPSBtYWdpY1tpZF1cclxuXHRcdFx0IyBlY2hvICd1cGRhdGVwbGF5ZXJzJyxtYWdpYywgclxyXG5cdFx0XHRpZiBpID09IEBtYXRyaXgubGVuZ3RoIG9yIGogPT0gQG1hdHJpeFswXS5sZW5ndGggdGhlbiBjb250aW51ZVxyXG5cdFx0XHRAbWF0cml4W2ldW2pdID0gKHIgKyAxKS50b1N0cmluZygpXHJcblx0XHRcdGlmIGkgPiBqIHRoZW4gY29udGludWVcclxuXHRcdFx0QHN1bW1hICs9IE1hdGguYWJzIEBwbGF5ZXJzW2ldLmVsbyAtIEBwbGF5ZXJzW2pdLmVsb1xyXG5cdFx0XHRhID0gQHBsYXllcnNbaV1cclxuXHRcdFx0YiA9IEBwbGF5ZXJzW2pdXHJcblx0XHRcdGEub3BwLnB1c2ggalxyXG5cdFx0XHRiLm9wcC5wdXNoIGlcclxuXHRcdFx0aWYgYS5iYWxhbnMoKSA+IGIuYmFsYW5zKClcclxuXHRcdFx0XHRhLmNvbCArPSAnYidcclxuXHRcdFx0XHRiLmNvbCArPSAndydcclxuXHRcdFx0XHR0YWJsZXMucHVzaCBbaiwgaV0gIywgYS5lbG8gKyBiLmVsb11cclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdGEuY29sICs9ICd3J1xyXG5cdFx0XHRcdGIuY29sICs9ICdiJ1xyXG5cdFx0XHRcdHRhYmxlcy5wdXNoIFtpLCBqXSAjLCBhLmVsbyArIGIuZWxvXVxyXG5cclxuXHRcdCNAc29ydFRhYmxlcyB0YWJsZXNcclxuXHRcdCNlY2hvICd1cGRhdGVQbGF5ZXJzJyx0YWJsZXNcclxuXHRcdHRhYmxlc1xyXG5cclxuXHRvayA6IChhLGIpIC0+IFxyXG5cdFx0aWYgYS5pZCA9PSBiLmlkIHRoZW4gcmV0dXJuIGZhbHNlXHJcblx0XHRpZiBhLmlkIGluIGIub3BwIHRoZW4gcmV0dXJuIGZhbHNlXHJcblx0XHRpZiBAR0FNRVMgJSAyID09IDAgdGhlbiByZXR1cm4gdHJ1ZVxyXG5cdFx0TWF0aC5hYnMoYS5iYWxhbnMoKSArIGIuYmFsYW5zKCkpIDwgMlxyXG4iXX0=
//# sourceURL=c:\github\2025\013-FloatingBerger\fairpair.coffee