// Generated by CoffeeScript 2.7.0
var echo, range,
  indexOf = [].indexOf;

import {
  Edmonds
} from './blossom.js';

range = _.range;

echo = console.log;

export var Floating = class Floating {
  constructor(players, settings) {
    var edges, edmonds, i, j, k, len, magic, r, ref;
    this.players = players;
    this.settings = settings;
    this.N = this.players.length;
    if (this.settings.sort === 1) {
      this.players.sort(function(a, b) {
        return a.elo - b.elo;
      });
    }
    echo(this.players);
    this.matrix = (function() {
      var k, len, ref, results;
      ref = range(this.N);
      results = [];
      for (k = 0, len = ref.length; k < len; k++) {
        j = ref[k];
        results.push((function() {
          var l, len1, ref1, results1;
          ref1 = range(this.N);
          results1 = [];
          for (l = 0, len1 = ref1.length; l < len1; l++) {
            i = ref1[l];
            results1.push("â€¢");
          }
          return results1;
        }).call(this));
      }
      return results;
    }).call(this);
    echo(this.matrix);
    this.summa = 0;
    this.rounds = [];
    ref = range(this.settings.ROUNDS);
    for (k = 0, len = ref.length; k < len; k++) {
      r = ref[k];
      edges = this.makeEdges();
      echo('edges', edges);
      edmonds = new Edmonds(edges);
      magic = edmonds.maxWeightMatching(edges);
      //echo 'magic',magic
      this.rounds.push(this.updatePlayers(magic, r));
    }
  }

  makeEdges() {
    var a, b, diff, edges, i, j, k, l, len, len1, ref, ref1;
    edges = [];
    ref = range(this.N);
    for (k = 0, len = ref.length; k < len; k++) {
      i = ref[k];
      a = this.players[i];
      ref1 = range(this.N);
      for (l = 0, len1 = ref1.length; l < len1; l++) {
        j = ref1[l];
        if (i === j) {
          this.matrix[i][j] = ' ';
        }
        b = this.players[j];
        diff = Math.abs(a.elo - b.elo);
        if (this.ok(a, b)) {
          edges.push([i, j, 10000 - diff ** 1.01]);
        }
      }
    }
    return edges;
  }

  // sortTables : (tables) -> # Blossom verkar redan ge en bra bordsplacering
  // 	tables.sort (x,y) -> y[2] - x[2]
  // 	table.slice 0,2 for table in tables
  ok(a, b) {
    var ref;
    if (a.id === b.id) {
      return false;
    }
    if (ref = a.id, indexOf.call(b.opp, ref) >= 0) {
      return false;
    }
    // if not @settings.BALANS and @settings.GAMES % 2 == 0 then return true
    if (this.settings.BALANS === 0) {
      return true;
    }
    return Math.abs(a.balans() + b.balans()) < 2;
  }

  updatePlayers(magic, r) {
    var a, b, i, id, j, k, len, tables;
    tables = [];
    echo('matrix', this.matrix);
    for (k = 0, len = magic.length; k < len; k++) {
      id = magic[k];
      i = id;
      j = magic[id];
      if (i === this.matrix.length || j === this.matrix[0].length) {
        continue;
      }
      this.matrix[i][j] = `${r + this.settings.ONE}`;
      if (i > j) {
        continue;
      }
      echo(i + this.settings.ONE, j + this.settings.ONE, Math.abs(this.players[i].elo - this.players[j].elo));
      this.summa += Math.abs(this.players[i].elo - this.players[j].elo);
      a = this.players[i];
      b = this.players[j];
      a.opp.push(j);
      b.opp.push(i);
      if (a.balans() > b.balans()) {
        a.col += 'b';
        b.col += 'w';
        tables.push([j, i]);
      } else {
        a.col += 'w';
        b.col += 'b';
        tables.push([i, j]);
      }
    }
    //@sortTables tables
    //echo 'updatePlayers',tables
    return tables;
  }

};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmxvYXRpbmcuanMiLCJzb3VyY2VSb290IjoiXFwiLCJzb3VyY2VzIjpbImZsb2F0aW5nLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsSUFBQSxJQUFBLEVBQUEsS0FBQTtFQUFBOztBQUFBLE9BQUE7RUFBUyxPQUFUO0NBQUEsTUFBQTs7QUFFQSxLQUFBLEdBQVEsQ0FBQyxDQUFDOztBQUNWLElBQUEsR0FBTyxPQUFPLENBQUM7O0FBRWYsT0FBQSxJQUFhLFdBQU4sTUFBQSxTQUFBO0VBQ04sV0FBYyxRQUFBLFVBQUEsQ0FBQTtBQUNmLFFBQUEsS0FBQSxFQUFBLE9BQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEVBQUEsS0FBQSxFQUFBLENBQUEsRUFBQTtJQURnQixJQUFDLENBQUE7SUFBUyxJQUFDLENBQUE7SUFDekIsSUFBQyxDQUFBLENBQUQsR0FBSyxJQUFDLENBQUEsT0FBTyxDQUFDO0lBQ2QsSUFBRyxJQUFDLENBQUEsUUFBUSxDQUFDLElBQVYsS0FBZ0IsQ0FBbkI7TUFBMEIsSUFBQyxDQUFBLE9BQU8sQ0FBQyxJQUFULENBQWMsUUFBQSxDQUFDLENBQUQsRUFBRyxDQUFILENBQUE7ZUFBUyxDQUFDLENBQUMsR0FBRixHQUFRLENBQUMsQ0FBQztNQUFuQixDQUFkLEVBQTFCOztJQUNBLElBQUEsQ0FBSyxJQUFDLENBQUEsT0FBTjtJQUNBLElBQUMsQ0FBQSxNQUFEOztBQUFXO0FBQUE7TUFBQSxLQUFBLHFDQUFBOzs7O0FBQUM7QUFBQTtVQUFBLEtBQUEsd0NBQUE7OzBCQUFBO1VBQUEsQ0FBQTs7O01BQUQsQ0FBQTs7O0lBQ1gsSUFBQSxDQUFLLElBQUMsQ0FBQSxNQUFOO0lBQ0EsSUFBQyxDQUFBLEtBQUQsR0FBUztJQUNULElBQUMsQ0FBQSxNQUFELEdBQVU7QUFFVjtJQUFBLEtBQUEscUNBQUE7O01BQ0MsS0FBQSxHQUFRLElBQUMsQ0FBQSxTQUFELENBQUE7TUFDUixJQUFBLENBQUssT0FB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QUFDLENBQUEsT0FBTyxDQUFDLENBQUQsQ0FBRyxDQUFDLEdBQXZDLENBQTNDO01BQ0EsSUFBQyxDQUFBLEtBQUQsSUFBVSxJQUFJLENBQUMsR0FBTCxDQUFTLElBQUMsQ0FBQSxPQUFPLENBQUMsQ0FBRCxDQUFHLENBQUMsR0FBWixHQUFrQixJQUFDLENBQUEsT0FBTyxDQUFDLENBQUQsQ0FBRyxDQUFDLEdBQXZDO01BQ1YsQ0FBQSxHQUFJLElBQUMsQ0FBQSxPQUFPLENBQUMsQ0FBRDtNQUNaLENBQUEsR0FBSSxJQUFDLENBQUEsT0FBTyxDQUFDLENBQUQ7TUFDWixDQUFDLENBQUMsR0FBRyxDQUFDLElBQU4sQ0FBVyxDQUFYO01BQ0EsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFOLENBQVcsQ0FBWDtNQUNBLElBQUcsQ0FBQyxDQUFDLE1BQUYsQ0FBQSxDQUFBLEdBQWEsQ0FBQyxDQUFDLE1BQUYsQ0FBQSxDQUFoQjtRQUNDLENBQUMsQ0FBQyxHQUFGLElBQVM7UUFDVCxDQUFDLENBQUMsR0FBRixJQUFTO1FBQ1QsTUFBTSxDQUFDLElBQVAsQ0FBWSxDQUFDLENBQUQsRUFBSSxDQUFKLENBQVosRUFIRDtPQUFBLE1BQUE7UUFLQyxDQUFDLENBQUMsR0FBRixJQUFTO1FBQ1QsQ0FBQyxDQUFDLEdBQUYsSUFBUztRQUNULE1BQU0sQ0FBQyxJQUFQLENBQVksQ0FBQyxDQUFELEVBQUksQ0FBSixDQUFaLEVBUEQ7O0lBWkQsQ0FGRjs7O1dBeUJFO0VBMUJlOztBQXhDViIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVkbW9uZHMgfSBmcm9tICcuL2Jsb3Nzb20uanMnICBcclxuXHJcbnJhbmdlID0gXy5yYW5nZVxyXG5lY2hvID0gY29uc29sZS5sb2dcclxuXHJcbmV4cG9ydCBjbGFzcyBGbG9hdGluZ1xyXG5cdGNvbnN0cnVjdG9yIDogKEBwbGF5ZXJzLCBAc2V0dGluZ3MpIC0+XHJcblx0XHRATiA9IEBwbGF5ZXJzLmxlbmd0aFxyXG5cdFx0aWYgQHNldHRpbmdzLnNvcnQ9PTEgdGhlbiBAcGxheWVycy5zb3J0IChhLGIpIC0+IGEuZWxvIC0gYi5lbG9cclxuXHRcdGVjaG8gQHBsYXllcnNcclxuXHRcdEBtYXRyaXggPSAoKFwi4oCiXCIgZm9yIGkgaW4gcmFuZ2UgQE4pIGZvciBqIGluIHJhbmdlIEBOKVxyXG5cdFx0ZWNobyBAbWF0cml4XHJcblx0XHRAc3VtbWEgPSAwXHJcblx0XHRAcm91bmRzID0gW11cclxuXHJcblx0XHRmb3IgciBpbiByYW5nZSBAc2V0dGluZ3MuUk9VTkRTXHJcblx0XHRcdGVkZ2VzID0gQG1ha2VFZGdlcygpXHJcblx0XHRcdGVjaG8gJ2VkZ2VzJyxlZGdlc1xyXG5cdFx0XHRlZG1vbmRzID0gbmV3IEVkbW9uZHMgZWRnZXNcclxuXHRcdFx0bWFnaWMgPSBlZG1vbmRzLm1heFdlaWdodE1hdGNoaW5nIGVkZ2VzXHJcblx0XHRcdCNlY2hvICdtYWdpYycsbWFnaWNcclxuXHRcdFx0QHJvdW5kcy5wdXNoIEB1cGRhdGVQbGF5ZXJzIG1hZ2ljLHJcclxuXHJcblx0bWFrZUVkZ2VzIDogLT5cclxuXHRcdGVkZ2VzID0gW10gXHJcblx0XHRmb3IgaSBpbiByYW5nZSBATlxyXG5cdFx0XHRhID0gQHBsYXllcnNbaV1cclxuXHRcdFx0Zm9yIGogaW4gcmFuZ2UgQE5cclxuXHRcdFx0XHRpZiBpPT1qIHRoZW4gQG1hdHJpeFtpXVtqXSA9ICcgJ1xyXG5cdFx0XHRcdGIgPSBAcGxheWVyc1tqXVxyXG5cdFx0XHRcdGRpZmYgPSBNYXRoLmFicyBhLmVsbyAtIGIuZWxvXHJcblx0XHRcdFx0aWYgQG9rIGEsYiB0aGVuIGVkZ2VzLnB1c2ggW2ksIGosIDEwMDAwIC0gZGlmZiAqKiAxLjAxXVxyXG5cdFx0ZWRnZXNcclxuXHJcblx0IyBzb3J0VGFibGVzIDogKHRhYmxlcykgLT4gIyBCbG9zc29tIHZlcmthciByZWRhbiBnZSBlbiBicmEgYm9yZHNwbGFjZXJpbmdcclxuXHQjIFx0dGFibGVzLnNvcnQgKHgseSkgLT4geVsyXSAtIHhbMl1cclxuXHQjIFx0dGFibGUuc2xpY2UgMCwyIGZvciB0YWJsZSBpbiB0YWJsZXNcclxuXHJcblx0b2sgOiAoYSxiKSAtPiBcclxuXHRcdGlmIGEuaWQgPT0gYi5pZCB0aGVuIHJldHVybiBmYWxzZVxyXG5cdFx0aWYgYS5pZCBpbiBiLm9wcCB0aGVuIHJldHVybiBmYWxzZVxyXG5cdFx0IyBpZiBub3QgQHNldHRpbmdzLkJBTEFOUyBhbmQgQHNldHRpbmdzLkdBTUVTICUgMiA9PSAwIHRoZW4gcmV0dXJuIHRydWVcclxuXHRcdGlmIEBzZXR0aW5ncy5CQUxBTlMgPT0gMCB0aGVuIHJldHVybiB0cnVlXHJcblx0XHRNYXRoLmFicyhhLmJhbGFucygpICsgYi5iYWxhbnMoKSkgPCAyXHJcblxyXG5cdHVwZGF0ZVBsYXllcnMgOiAobWFnaWMscikgLT4gXHJcblx0XHR0YWJsZXMgPSBbXVxyXG5cdFx0ZWNobyAnbWF0cml4JyxAbWF0cml4XHJcblx0XHRmb3IgaWQgaW4gbWFnaWNcclxuXHRcdFx0aSA9IGlkXHJcblx0XHRcdGogPSBtYWdpY1tpZF1cclxuXHRcdFx0aWYgaSA9PSBAbWF0cml4Lmxlbmd0aCBvciBqID09IEBtYXRyaXhbMF0ubGVuZ3RoIHRoZW4gY29udGludWVcclxuXHRcdFx0QG1hdHJpeFtpXVtqXSA9IFwiI3tyICsgQHNldHRpbmdzLk9ORX1cIlxyXG5cdFx0XHRpZiBpID4gaiB0aGVuIGNvbnRpbnVlXHJcblx0XHRcdGVjaG8gaSArIEBzZXR0aW5ncy5PTkUsIGogKyBAc2V0dGluZ3MuT05FLCBNYXRoLmFicyBAcGxheWVyc1tpXS5lbG8gLSBAcGxheWVyc1tqXS5lbG9cclxuXHRcdFx0QHN1bW1hICs9IE1hdGguYWJzIEBwbGF5ZXJzW2ldLmVsbyAtIEBwbGF5ZXJzW2pdLmVsb1xyXG5cdFx0XHRhID0gQHBsYXllcnNbaV1cclxuXHRcdFx0YiA9IEBwbGF5ZXJzW2pdXHJcblx0XHRcdGEub3BwLnB1c2ggalxyXG5cdFx0XHRiLm9wcC5wdXNoIGlcclxuXHRcdFx0aWYgYS5iYWxhbnMoKSA+IGIuYmFsYW5zKClcclxuXHRcdFx0XHRhLmNvbCArPSAnYidcclxuXHRcdFx0XHRiLmNvbCArPSAndydcclxuXHRcdFx0XHR0YWJsZXMucHVzaCBbaiwgaV1cclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdGEuY29sICs9ICd3J1xyXG5cdFx0XHRcdGIuY29sICs9ICdiJ1xyXG5cdFx0XHRcdHRhYmxlcy5wdXNoIFtpLCBqXVxyXG5cclxuXHRcdCNAc29ydFRhYmxlcyB0YWJsZXNcclxuXHRcdCNlY2hvICd1cGRhdGVQbGF5ZXJzJyx0YWJsZXNcclxuXHRcdHRhYmxlc1xyXG4iXX0=
//# sourceURL=c:\github\2025\013-FloatingBerger\floating.coffee