// Generated by CoffeeScript 2.7.0
import {
  echo,
  global,
  range,
  settings
} from './global.js';

import {
  elo_formula,
  performance
} from './rating.js';

export var Player = class Player {
  constructor(id, name, elo1) {
    this.id = id;
    this.name = name;
    this.elo = elo1;
    this.fideid = "1712345";
    this.born = "0000";
    this.federation = "   ";
    this.sex = " ";
    this.title = "   ";
    this.opp = []; // används endast av Floating
    this.col = ""; // används endast av Floating
    this.summa = 0;
    this.P = 0;
    this.PR = 0;
  }

  balance() {
    var b, c, j, len, ref;
    b = 0;
    ref = this.col;
    for (j = 0, len = ref.length; j < len; j++) {
      c = ref[j];
      if (c === 'w') {
        b++;
      }
      if (c === 'b') {
        b--;
      }
    }
    return b;
  }

  toString() {
    return `${String(this.elo).padStart(4, '0')} ${this.name}`;
  }

  getElos(long) {
    var ch, elo, j, len, opp, r, ref, value;
    this.P = 0;
    this.PR = 0;
    this.elos = [this.elo, ':'];
    ref = range(settings.GAMES * settings.ROUNDS);
    for (j = 0, len = ref.length; j < len; j++) {
      r = ref[j];
      ch = long[r][3];
      value = '012'.indexOf(ch);
      opp = long[r][1];
      if (value !== -1) {
        elo = global.players[opp].elo;
        this.P += value / 2;
        if (elo !== 0) {
          this.PR += value / 2;
          this.elos.push(Math.round(elo));
        }
      } else {
        this.elos.push('    ');
      }
    }
    this.elos.push(this.PR);
    return this.elos.join(' ');
  }

  // update_P_and_PR : (longs,i) ->
  // 	long = longs[i]
  // 	#echo 'longs',longs
  // 	@P = 0
  // 	@PR = 0
  // 	@elos = []
  // 	for r in range settings.GAMES * settings.ROUNDS
  // 		ch = long[r][3]
  // 		value = '012'.indexOf ch
  // 		opp = long[r][1]
  // 		if value != -1
  // 			elo = global.players[opp].elo
  // 			@P += value/2
  // 			if elo != 0
  // 				@PR += value/2
  // 				@elos.push Math.round elo

    // 	# kalkylera performance rating mha vinstandel och elo-tal
  // 	if @elos.length == 0 
  // 		@PR = 0
  // 	else
  // 		andel = @PR
  // 		perf = performance andel, @elos
  // 		@PR = perf
  update_P_and_PR(longs, i) {
    var andel, ch, elo, j, len, long, opp, perf, r, ref, value;
    long = longs[i];
    //echo 'longs',longs
    this.P = 0;
    // @Q = 0
    this.PR = 0;
    this.elos = [];
    ref = range(settings.GAMES * settings.ROUNDS);
    for (j = 0, len = ref.length; j < len; j++) {
      r = ref[j];
      ch = long[r][3];
      value = '012'.indexOf(ch);
      opp = long[r][1];
      if (value !== -1) {
        elo = global.players[opp].elo;
        this.P += value / 2;
        if (elo !== 0) {
          this.PR += value / 2;
          this.elos.push(Math.round(elo));
        }
      }
    }
    // kalkylera performance rating mha vinstandel och elo-tal
    if (this.elos.length === 0) {
      this.PR = 0;
    } else {
      andel = this.PR;
      perf = performance(andel, this.elos);
      this.PR = perf;
    }
    echo('A', this.name, this.PR, global.average);
    this.Q = settings.GAMES * settings.ROUNDS * elo_formula(global.average - this.PR);
    return echo('B', this.elo, settings.GAMES * settings.ROUNDS, this.Q, elo_formula(global.average - this.PR));
  }

};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGxheWVyLmpzIiwic291cmNlUm9vdCI6IlxcIiwic291cmNlcyI6WyJwbGF5ZXIuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFBO0VBQVEsSUFBUjtFQUFhLE1BQWI7RUFBb0IsS0FBcEI7RUFBMEIsUUFBMUI7Q0FBQSxNQUFBOztBQUNBLE9BQUE7RUFBUSxXQUFSO0VBQW9CLFdBQXBCO0NBQUEsTUFBQTs7QUFFQSxPQUFBLElBQWEsU0FBTixNQUFBLE9BQUE7RUFFTixXQUFjLEdBQUEsTUFBQSxNQUFBLENBQUE7SUFBQyxJQUFDLENBQUE7SUFBSSxJQUFDLENBQUE7SUFBTSxJQUFDLENBQUE7SUFDM0IsSUFBQyxDQUFBLE1BQUQsR0FBVTtJQUNWLElBQUMsQ0FBQSxJQUFELEdBQVE7SUFDUixJQUFDLENBQUEsVUFBRCxHQUFjO0lBQ2QsSUFBQyxDQUFBLEdBQUQsR0FBTztJQUNQLElBQUMsQ0FBQSxLQUFELEdBQVM7SUFDVCxJQUFDLENBQUEsR0FBRCxHQUFPLEdBTFQ7SUFNRSxJQUFDLENBQUEsR0FBRCxHQUFPLEdBTlQ7SUFPRSxJQUFDLENBQUEsS0FBRCxHQUFTO0lBQ1QsSUFBQyxDQUFBLENBQUQsR0FBSztJQUNMLElBQUMsQ0FBQSxFQUFELEdBQU07RUFWTzs7RUFZZCxPQUFVLENBQUEsQ0FBQTtBQUNYLFFBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsR0FBQSxFQUFBO0lBQUUsQ0FBQSxHQUFJO0FBQ0o7SUFBQSxLQUFBLHFDQUFBOztNQUNDLElBQUcsQ0FBQSxLQUFLLEdBQVI7UUFBaUIsQ0FBQSxHQUFqQjs7TUFDQSxJQUFHLENBQUEsS0FBSyxHQUFSO1FBQWlCLENBQUEsR0FBakI7O0lBRkQ7V0FHQTtFQUxTOztFQU9WLFFBQVcsQ0FBQSxDQUFBO1dBQUcsQ0FBQSxDQUFBLENBQUcsTUFBQSxDQUFPLElBQUMsQ0FBQSxHQUFSLENBQVksQ0FBQyxRQUFiLENBQXNCLENBQXRCLEVBQXlCLEdBQXpCLENBQUgs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QTdCO0lBQ0EsSUFBQyxDQUFBLENBQUQsR0FBSyxRQUFRLENBQUMsS0FBVCxHQUFpQixRQUFRLENBQUMsTUFBMUIsR0FBbUMsV0FBQSxDQUFZLE1BQU0sQ0FBQyxPQUFQLEdBQWlCLElBQUMsQ0FBQSxFQUE5QjtXQUN4QyxJQUFBLENBQUssR0FBTCxFQUFVLElBQUMsQ0FBQSxHQUFYLEVBQWdCLFFBQVEsQ0FBQyxLQUFULEdBQWlCLFFBQVEsQ0FBQyxNQUExQyxFQUFrRCxJQUFDLENBQUEsQ0FBbkQsRUFBc0QsV0FBQSxDQUFZLE1BQU0sQ0FBQyxPQUFQLEdBQWlCLElBQUMsQ0FBQSxFQUE5QixDQUF0RDtFQTVCaUI7O0FBcEVaIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtlY2hvLGdsb2JhbCxyYW5nZSxzZXR0aW5nc30gZnJvbSAnLi9nbG9iYWwuanMnXHJcbmltcG9ydCB7ZWxvX2Zvcm11bGEscGVyZm9ybWFuY2V9IGZyb20gJy4vcmF0aW5nLmpzJ1xyXG5cclxuZXhwb3J0IGNsYXNzIFBsYXllclxyXG5cclxuXHRjb25zdHJ1Y3RvciA6IChAaWQsIEBuYW1lLCBAZWxvKSAtPlxyXG5cdFx0QGZpZGVpZCA9IFwiMTcxMjM0NVwiXHJcblx0XHRAYm9ybiA9IFwiMDAwMFwiXHJcblx0XHRAZmVkZXJhdGlvbiA9IFwiICAgXCJcclxuXHRcdEBzZXggPSBcIiBcIlxyXG5cdFx0QHRpdGxlID0gXCIgICBcIlxyXG5cdFx0QG9wcCA9IFtdICMgYW52w6RuZHMgZW5kYXN0IGF2IEZsb2F0aW5nXHJcblx0XHRAY29sID0gXCJcIiAjIGFudsOkbmRzIGVuZGFzdCBhdiBGbG9hdGluZ1xyXG5cdFx0QHN1bW1hID0gMFxyXG5cdFx0QFAgPSAwXHJcblx0XHRAUFIgPSAwXHJcblxyXG5cdGJhbGFuY2UgOiAtPlxyXG5cdFx0YiA9IDBcclxuXHRcdGZvciBjIGluIEBjb2xcclxuXHRcdFx0aWYgYyA9PSAndycgdGhlbiBiKytcclxuXHRcdFx0aWYgYyA9PSAnYicgdGhlbiBiLS1cclxuXHRcdGJcclxuXHJcblx0dG9TdHJpbmcgOiAtPiBcIiN7U3RyaW5nKEBlbG8pLnBhZFN0YXJ0IDQsICcwJ30gI3tAbmFtZX1cIlxyXG5cclxuXHRnZXRFbG9zIDogKGxvbmcpIC0+XHJcblx0XHRAUCA9IDBcclxuXHRcdEBQUiA9IDBcclxuXHRcdEBlbG9zID0gW0BlbG8sICc6J11cclxuXHRcdGZvciByIGluIHJhbmdlIHNldHRpbmdzLkdBTUVTICogc2V0dGluZ3MuUk9VTkRTXHJcblx0XHRcdGNoID0gbG9uZ1tyXVszXVxyXG5cdFx0XHR2YWx1ZSA9ICcwMTInLmluZGV4T2YgY2hcclxuXHRcdFx0b3BwID0gbG9uZ1tyXVsxXVxyXG5cdFx0XHRpZiB2YWx1ZSAhPSAtMVxyXG5cdFx0XHRcdGVsbyA9IGdsb2JhbC5wbGF5ZXJzW29wcF0uZWxvXHJcblx0XHRcdFx0QFAgKz0gdmFsdWUvMlxyXG5cdFx0XHRcdGlmIGVsbyAhPSAwXHJcblx0XHRcdFx0XHRAUFIgKz0gdmFsdWUvMlxyXG5cdFx0XHRcdFx0QGVsb3MucHVzaCBNYXRoLnJvdW5kIGVsb1xyXG5cdFx0XHRlbHNlXHJcblx0XHRcdFx0QGVsb3MucHVzaCAnICAgICdcclxuXHRcdFx0XHJcblx0XHRAZWxvcy5wdXNoIEBQUlxyXG5cdFx0QGVsb3Muam9pbiAnICdcclxuXHJcblx0IyB1cGRhdGVfUF9hbmRfUFIgOiAobG9uZ3MsaSkgLT5cclxuXHQjIFx0bG9uZyA9IGxvbmdzW2ldXHJcblx0IyBcdCNlY2hvICdsb25ncycsbG9uZ3NcclxuXHQjIFx0QFAgPSAwXHJcblx0IyBcdEBQUiA9IDBcclxuXHQjIFx0QGVsb3MgPSBbXVxyXG5cdCMgXHRmb3IgciBpbiByYW5nZSBzZXR0aW5ncy5HQU1FUyAqIHNldHRpbmdzLlJPVU5EU1xyXG5cdCMgXHRcdGNoID0gbG9uZ1tyXVszXVxyXG5cdCMgXHRcdHZhbHVlID0gJzAxMicuaW5kZXhPZiBjaFxyXG5cdCMgXHRcdG9wcCA9IGxvbmdbcl1bMV1cclxuXHQjIFx0XHRpZiB2YWx1ZSAhPSAtMVxyXG5cdCMgXHRcdFx0ZWxvID0gZ2xvYmFsLnBsYXllcnNbb3BwXS5lbG9cclxuXHQjIFx0XHRcdEBQICs9IHZhbHVlLzJcclxuXHQjIFx0XHRcdGlmIGVsbyAhPSAwXHJcblx0IyBcdFx0XHRcdEBQUiArPSB2YWx1ZS8yXHJcblx0IyBcdFx0XHRcdEBlbG9zLnB1c2ggTWF0aC5yb3VuZCBlbG9cclxuXHJcblx0IyBcdCMga2Fsa3lsZXJhIHBlcmZvcm1hbmNlIHJhdGluZyBtaGEgdmluc3RhbmRlbCBvY2ggZWxvLXRhbFxyXG5cdCMgXHRpZiBAZWxvcy5sZW5ndGggPT0gMCBcclxuXHQjIFx0XHRAUFIgPSAwXHJcblx0IyBcdGVsc2VcclxuXHQjIFx0XHRhbmRlbCA9IEBQUlxyXG5cdCMgXHRcdHBlcmYgPSBwZXJmb3JtYW5jZSBhbmRlbCwgQGVsb3NcclxuXHQjIFx0XHRAUFIgPSBwZXJmXHJcblxyXG5cdHVwZGF0ZV9QX2FuZF9QUiA6IChsb25ncyxpKSAtPlxyXG5cdFx0bG9uZyA9IGxvbmdzW2ldXHJcblx0XHQjZWNobyAnbG9uZ3MnLGxvbmdzXHJcblx0XHRAUCA9IDBcclxuXHRcdCMgQFEgPSAwXHJcblx0XHRAUFIgPSAwXHJcblx0XHRAZWxvcyA9IFtdXHJcblx0XHRmb3IgciBpbiByYW5nZSBzZXR0aW5ncy5HQU1FUyAqIHNldHRpbmdzLlJPVU5EU1xyXG5cdFx0XHRjaCA9IGxvbmdbcl1bM11cclxuXHRcdFx0dmFsdWUgPSAnMDEyJy5pbmRleE9mIGNoXHJcblx0XHRcdG9wcCA9IGxvbmdbcl1bMV1cclxuXHRcdFx0aWYgdmFsdWUgIT0gLTFcclxuXHRcdFx0XHRlbG8gPSBnbG9iYWwucGxheWVyc1tvcHBdLmVsb1xyXG5cdFx0XHRcdEBQICs9IHZhbHVlLzJcclxuXHRcdFx0XHRpZiBlbG8gIT0gMFxyXG5cdFx0XHRcdFx0QFBSICs9IHZhbHVlLzJcclxuXHRcdFx0XHRcdEBlbG9zLnB1c2ggTWF0aC5yb3VuZCBlbG9cclxuXHJcblx0XHQjIGthbGt5bGVyYSBwZXJmb3JtYW5jZSByYXRpbmcgbWhhIHZpbnN0YW5kZWwgb2NoIGVsby10YWxcclxuXHRcdGlmIEBlbG9zLmxlbmd0aCA9PSAwIFxyXG5cdFx0XHRAUFIgPSAwXHJcblx0XHRlbHNlXHJcblx0XHRcdGFuZGVsID0gQFBSXHJcblx0XHRcdHBlcmYgPSBwZXJmb3JtYW5jZSBhbmRlbCwgQGVsb3NcclxuXHRcdFx0QFBSID0gcGVyZlxyXG5cclxuXHRcdGVjaG8gJ0EnLCBAbmFtZSwgQFBSLCBnbG9iYWwuYXZlcmFnZVxyXG5cdFx0QFEgPSBzZXR0aW5ncy5HQU1FUyAqIHNldHRpbmdzLlJPVU5EUyAqIGVsb19mb3JtdWxhIGdsb2JhbC5hdmVyYWdlIC0gQFBSXHJcblx0XHRlY2hvICdCJywgQGVsbywgc2V0dGluZ3MuR0FNRVMgKiBzZXR0aW5ncy5ST1VORFMsIEBRLCBlbG9fZm9ybXVsYSBnbG9iYWwuYXZlcmFnZSAtIEBQUlxyXG5cclxuIl19
//# sourceURL=c:\github\2025\035-FairPair\player.coffee