// Generated by CoffeeScript 2.7.0
var indexOf = [].indexOf;

import {
  echo,
  global,
  range,
  settings
} from './global.js';

import {
  elo_formula,
  performance
} from './rating.js';

export var Player = class Player {
  constructor(id, name, elo1, fideid) {
    this.id = id;
    this.name = name;
    this.elo = elo1;
    this.fideid = fideid;
    // @fideid = "1712345"
    this.born = "0000";
    this.federation = "   ";
    this.sex = " ";
    this.title = "   ";
    this.opp = []; // används endast av Floating
    this.col = ""; // används endast av Floating
    this.summa = 0;
    this.P = 0;
    this.PR = 0;
  }

  balance() {
    var b, c, j, len, ref;
    b = 0;
    ref = this.col;
    for (j = 0, len = ref.length; j < len; j++) {
      c = ref[j];
      if (c === 'w') {
        b++;
      }
      if (c === 'b') {
        b--;
      }
    }
    return b;
  }

  toString() {
    return `${String(this.elo).padStart(4, '0')} ${this.name}`;
  }

  getElos(long) {
    var ch, elo, j, len, opp, r, ref, value;
    this.P = 0;
    this.PR = 0;
    this.elos = [this.elo, ':'];
    ref = range(settings.GAMES * settings.ROUNDS);
    for (j = 0, len = ref.length; j < len; j++) {
      r = ref[j];
      ch = long[r][3];
      value = '012'.indexOf(ch);
      opp = long[r][1];
      if (value !== -1) {
        elo = global.players[opp].elo;
        this.P += value / 2;
        if (elo !== 0) {
          this.PR += value / 2;
          this.elos.push(Math.round(elo));
        }
      } else {
        this.elos.push('    ');
      }
    }
    this.elos.push(this.PR);
    return this.elos.join(' ');
  }

  // update_P_and_PR : (longs,i) ->
  // 	long = longs[i]
  // 	#echo 'longs',longs
  // 	@P = 0
  // 	@PR = 0
  // 	@elos = []
  // 	for r in range settings.GAMES * settings.ROUNDS
  // 		ch = long[r][3]
  // 		value = '012'.indexOf ch
  // 		opp = long[r][1]
  // 		if value != -1
  // 			elo = global.players[opp].elo
  // 			@P += value/2
  // 			if elo != 0
  // 				@PR += value/2
  // 				@elos.push Math.round elo

    // 	# kalkylera performance rating mha vinstandel och elo-tal
  // 	if @elos.length == 0 
  // 		@PR = 0
  // 	else
  // 		andel = @PR
  // 		perf = performance andel, @elos
  // 		@PR = perf
  update_P_and_PR(longs, i) {
    var andel, antal, ch, diff, elo, j, len, long, opp, p, perf, points, r, ref, value;
    long = longs[i];
    // echo 'longs',longs
    this.P = 0;
    this.Q = 0;
    this.PR = 0;
    this.elos = [];
    points = [];
    antal = settings.GAMES * settings.ROUNDS;
    ref = range(antal);
    for (j = 0, len = ref.length; j < len; j++) {
      r = ref[j];
      ch = long[r][3];
      value = '012'.indexOf(ch);
      opp = long[r][1];
      if (indexOf.call('012', ch) >= 0) {
        if (opp === global.frirond) {
          elo = this.elo;
          p = 0.5;
        } else {
          elo = global.players[opp].elo;
          p = value / 2; // 'x'
        }
      } else {
        elo = global.players[opp].elo;
        if (elo === 0) {
          elo = 1400;
        }
        diff = elo - this.elo;
        p = elo_formula(diff);
      }
      this.P += p;
      this.PR += p;
      points.push(p);
      this.elos.push(Math.round(elo));
    }
    echo(points);
    echo(this.elos);
    // kalkylera performance rating mha vinstandel och elo-tal
    if (this.elos.length === 0) {
      this.PR = 0;
    } else {
      andel = this.PR;
      perf = performance(andel, this.elos);
      this.PR = perf;
    }
    echo('A', this.name, this.elo, this.P.toFixed(3), this.PR); //, global.average
    return this.Q = settings.GAMES * settings.ROUNDS * elo_formula(global.average - this.PR);
  }

};

// echo 'B', @elo, settings.GAMES * settings.ROUNDS, @Q, elo_formula global.average - @PR

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGxheWVyLmpzIiwic291cmNlUm9vdCI6IlxcIiwic291cmNlcyI6WyJwbGF5ZXIuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFBOztBQUFBLE9BQUE7RUFBUSxJQUFSO0VBQWEsTUFBYjtFQUFvQixLQUFwQjtFQUEwQixRQUExQjtDQUFBLE1BQUE7O0FBQ0EsT0FBQTtFQUFRLFdBQVI7RUFBb0IsV0FBcEI7Q0FBQSxNQUFBOztBQUVBLE9BQUEsSUFBYSxTQUFOLE1BQUEsT0FBQTtFQUVOLFdBQWMsR0FBQSxNQUFBLE1BQUEsUUFBQSxDQUFBO0lBQUMsSUFBQyxDQUFBO0lBQUksSUFBQyxDQUFBO0lBQU0sSUFBQyxDQUFBO0lBQUssSUFBQyxDQUFBLGdCQUNuQzs7SUFDRSxJQUFDLENBQUEsSUFBRCxHQUFRO0lBQ1IsSUFBQyxDQUFBLFVBQUQsR0FBYztJQUNkLElBQUMsQ0FBQSxHQUFELEdBQU87SUFDUCxJQUFDLENBQUEsS0FBRCxHQUFTO0lBQ1QsSUFBQyxDQUFBLEdBQUQsR0FBTyxHQUxUO0lBTUUsSUFBQyxDQUFBLEdBQUQsR0FBTyxHQU5UO0lBT0UsSUFBQyxDQUFBLEtBQUQsR0FBUztJQUNULElBQUMsQ0FBQSxDQUFELEdBQUs7SUFDTCxJQUFDLENBQUEsRUFBRCxHQUFNO0VBVk87O0VBWWQsT0FBVSxDQUFBLENBQUE7QUFDWCxRQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQTtJQUFFLENBQUEsR0FBSTtBQUNKO0lBQUEsS0FBQSxxQ0FBQTs7TUFDQyxJQUFHLENBQUEsS0FBSyxHQUFSO1FBQWlCLENBQUEsR0FBakI7O01BQ0EsSUFBRyxDQUFBLEtBQUssR0FBUjtRQUFpQixDQUFBLEdBQWpCOztJQUZEO1dBR0E7RUFMUzs7RUFPVixRQUFXLENBQUEsQ0FBQTtXQUFHLENBQUEsQ0FBQSxDQUFHLE1BQUEsQ0FBTyxJQUFDLENBQUEsR0FBUixDQUFZLENBQUMsUUFBYixDQUFzQixDQUF0QixFQUF5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Q04sSUFBQyxDQUFBLEVBQUQsSUFBTztNQUNQLE1BQU0sQ0FBQyxJQUFQLENBQVksQ0FBWjtNQUNBLElBQUMsQ0FBQSxJQUFJLENBQUMsSUFBTixDQUFXLElBQUksQ0FBQyxLQUFMLENBQVcsR0FBWCxDQUFYO0lBbkJEO0lBb0JBLElBQUEsQ0FBSyxNQUFMO0lBQ0EsSUFBQSxDQUFLLElBQUMsQ0FBQSxJQUFOLEVBN0JGOztJQWdDRSxJQUFHLElBQUMsQ0FBQSxJQUFJLENBQUMsTUFBTixLQUFnQixDQUFuQjtNQUNDLElBQUMsQ0FBQSxFQUFELEdBQU0sRUFEUDtLQUFBLE1BQUE7TUFHQyxLQUFBLEdBQVEsSUFBQyxDQUFBO01BQ1QsSUFBQSxHQUFPLFdBQUEsQ0FBWSxLQUFaLEVBQW1CLElBQUMsQ0FBQSxJQUFwQjtNQUNQLElBQUMsQ0FBQSxFQUFELEdBQU0sS0FMUDs7SUFPQSxJQUFBLENBQUssR0FBTCxFQUFVLElBQUMsQ0FBQSxJQUFYLEVBQWlCLElBQUMsQ0FBQSxHQUFsQixFQUF1QixJQUFDLENBQUEsQ0FBQyxDQUFDLE9BQUgsQ0FBVyxDQUFYLENBQXZCLEVBQXNDLElBQUMsQ0FBQSxFQUF2QyxFQXZDRjtXQXdDRSxJQUFDLENBQUEsQ0FBRCxHQUFLLFFBQVEsQ0FBQyxLQUFULEdBQWlCLFFBQVEsQ0FBQyxNQUExQixHQUFtQyxXQUFBLENBQVksTUFBTSxDQUFDLE9BQVAsR0FBaUIsSUFBQyxDQUFBLEVBQTlCO0VBekN2Qjs7QUFwRVo7O0FBSFAiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2VjaG8sZ2xvYmFsLHJhbmdlLHNldHRpbmdzfSBmcm9tICcuL2dsb2JhbC5qcydcclxuaW1wb3J0IHtlbG9fZm9ybXVsYSxwZXJmb3JtYW5jZX0gZnJvbSAnLi9yYXRpbmcuanMnXHJcblxyXG5leHBvcnQgY2xhc3MgUGxheWVyXHJcblxyXG5cdGNvbnN0cnVjdG9yIDogKEBpZCwgQG5hbWUsIEBlbG8sIEBmaWRlaWQpIC0+XHJcblx0XHQjIEBmaWRlaWQgPSBcIjE3MTIzNDVcIlxyXG5cdFx0QGJvcm4gPSBcIjAwMDBcIlxyXG5cdFx0QGZlZGVyYXRpb24gPSBcIiAgIFwiXHJcblx0XHRAc2V4ID0gXCIgXCJcclxuXHRcdEB0aXRsZSA9IFwiICAgXCJcclxuXHRcdEBvcHAgPSBbXSAjIGFudsOkbmRzIGVuZGFzdCBhdiBGbG9hdGluZ1xyXG5cdFx0QGNvbCA9IFwiXCIgIyBhbnbDpG5kcyBlbmRhc3QgYXYgRmxvYXRpbmdcclxuXHRcdEBzdW1tYSA9IDBcclxuXHRcdEBQID0gMFxyXG5cdFx0QFBSID0gMFxyXG5cclxuXHRiYWxhbmNlIDogLT5cclxuXHRcdGIgPSAwXHJcblx0XHRmb3IgYyBpbiBAY29sXHJcblx0XHRcdGlmIGMgPT0gJ3cnIHRoZW4gYisrXHJcblx0XHRcdGlmIGMgPT0gJ2InIHRoZW4gYi0tXHJcblx0XHRiXHJcblxyXG5cdHRvU3RyaW5nIDogLT4gXCIje1N0cmluZyhAZWxvKS5wYWRTdGFydCA0LCAnMCd9ICN7QG5hbWV9XCJcclxuXHJcblx0Z2V0RWxvcyA6IChsb25nKSAtPlxyXG5cdFx0QFAgPSAwXHJcblx0XHRAUFIgPSAwXHJcblx0XHRAZWxvcyA9IFtAZWxvLCAnOiddXHJcblx0XHRmb3IgciBpbiByYW5nZSBzZXR0aW5ncy5HQU1FUyAqIHNldHRpbmdzLlJPVU5EU1xyXG5cdFx0XHRjaCA9IGxvbmdbcl1bM11cclxuXHRcdFx0dmFsdWUgPSAnMDEyJy5pbmRleE9mIGNoXHJcblx0XHRcdG9wcCA9IGxvbmdbcl1bMV1cclxuXHRcdFx0aWYgdmFsdWUgIT0gLTFcclxuXHRcdFx0XHRlbG8gPSBnbG9iYWwucGxheWVyc1tvcHBdLmVsb1xyXG5cdFx0XHRcdEBQICs9IHZhbHVlLzJcclxuXHRcdFx0XHRpZiBlbG8gIT0gMFxyXG5cdFx0XHRcdFx0QFBSICs9IHZhbHVlLzJcclxuXHRcdFx0XHRcdEBlbG9zLnB1c2ggTWF0aC5yb3VuZCBlbG9cclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdEBlbG9zLnB1c2ggJyAgICAnXHJcblx0XHRcdFxyXG5cdFx0QGVsb3MucHVzaCBAUFJcclxuXHRcdEBlbG9zLmpvaW4gJyAnXHJcblxyXG5cdCMgdXBkYXRlX1BfYW5kX1BSIDogKGxvbmdzLGkpIC0+XHJcblx0IyBcdGxvbmcgPSBsb25nc1tpXVxyXG5cdCMgXHQjZWNobyAnbG9uZ3MnLGxvbmdzXHJcblx0IyBcdEBQID0gMFxyXG5cdCMgXHRAUFIgPSAwXHJcblx0IyBcdEBlbG9zID0gW11cclxuXHQjIFx0Zm9yIHIgaW4gcmFuZ2Ugc2V0dGluZ3MuR0FNRVMgKiBzZXR0aW5ncy5ST1VORFNcclxuXHQjIFx0XHRjaCA9IGxvbmdbcl1bM11cclxuXHQjIFx0XHR2YWx1ZSA9ICcwMTInLmluZGV4T2YgY2hcclxuXHQjIFx0XHRvcHAgPSBsb25nW3JdWzFdXHJcblx0IyBcdFx0aWYgdmFsdWUgIT0gLTFcclxuXHQjIFx0XHRcdGVsbyA9IGdsb2JhbC5wbGF5ZXJzW29wcF0uZWxvXHJcblx0IyBcdFx0XHRAUCArPSB2YWx1ZS8yXHJcblx0IyBcdFx0XHRpZiBlbG8gIT0gMFxyXG5cdCMgXHRcdFx0XHRAUFIgKz0gdmFsdWUvMlxyXG5cdCMgXHRcdFx0XHRAZWxvcy5wdXNoIE1hdGgucm91bmQgZWxvXHJcblxyXG5cdCMgXHQjIGthbGt5bGVyYSBwZXJmb3JtYW5jZSByYXRpbmcgbWhhIHZpbnN0YW5kZWwgb2NoIGVsby10YWxcclxuXHQjIFx0aWYgQGVsb3MubGVuZ3RoID09IDAgXHJcblx0IyBcdFx0QFBSID0gMFxyXG5cdCMgXHRlbHNlXHJcblx0IyBcdFx0YW5kZWwgPSBAUFJcclxuXHQjIFx0XHRwZXJmID0gcGVyZm9ybWFuY2UgYW5kZWwsIEBlbG9zXHJcblx0IyBcdFx0QFBSID0gcGVyZlxyXG5cclxuXHR1cGRhdGVfUF9hbmRfUFIgOiAobG9uZ3MsaSkgLT5cclxuXHRcdGxvbmcgPSBsb25nc1tpXVxyXG5cdFx0IyBlY2hvICdsb25ncycsbG9uZ3NcclxuXHRcdEBQID0gMFxyXG5cdFx0QFEgPSAwXHJcblx0XHRAUFIgPSAwXHJcblx0XHRAZWxvcyA9IFtdXHJcblx0XHRwb2ludHMgPSBbXVxyXG5cdFx0YW50YWwgPSBzZXR0aW5ncy5HQU1FUyAqIHNldHRpbmdzLlJPVU5EU1xyXG5cdFx0Zm9yIHIgaW4gcmFuZ2UgYW50YWxcclxuXHRcdFx0Y2ggPSBsb25nW3JdWzNdXHJcblx0XHRcdHZhbHVlID0gJzAxMicuaW5kZXhPZiBjaFxyXG5cdFx0XHRvcHAgPSBsb25nW3JdWzFdXHJcblx0XHRcdGlmIGNoIGluICcwMTInXHJcblx0XHRcdFx0aWYgb3BwID09IGdsb2JhbC5mcmlyb25kXHJcblx0XHRcdFx0XHRlbG8gPSBAZWxvXHJcblx0XHRcdFx0XHRwID0gMC41XHJcblx0XHRcdFx0ZWxzZVxyXG5cdFx0XHRcdFx0ZWxvID0gZ2xvYmFsLnBsYXllcnNbb3BwXS5lbG9cclxuXHRcdFx0XHRcdHAgPSB2YWx1ZS8yXHJcblx0XHRcdGVsc2UgIyAneCdcclxuXHRcdFx0XHRlbG8gPSBnbG9iYWwucGxheWVyc1tvcHBdLmVsb1xyXG5cdFx0XHRcdGlmIGVsbyA9PSAwIHRoZW4gZWxvID0gMTQwMFxyXG5cdFx0XHRcdGRpZmYgPSBlbG8gLSBAZWxvXHJcblx0XHRcdFx0cCA9IGVsb19mb3JtdWxhIGRpZmZcclxuXHRcdFx0QFAgKz0gcFxyXG5cdFx0XHRAUFIgKz0gcFxyXG5cdFx0XHRwb2ludHMucHVzaCBwXHJcblx0XHRcdEBlbG9zLnB1c2ggTWF0aC5yb3VuZCBlbG9cclxuXHRcdGVjaG8gcG9pbnRzXHJcblx0XHRlY2hvIEBlbG9zXHJcblxyXG5cdFx0IyBrYWxreWxlcmEgcGVyZm9ybWFuY2UgcmF0aW5nIG1oYSB2aW5zdGFuZGVsIG9jaCBlbG8tdGFsXHJcblx0XHRpZiBAZWxvcy5sZW5ndGggPT0gMCBcclxuXHRcdFx0QFBSID0gMFxyXG5cdFx0ZWxzZVxyXG5cdFx0XHRhbmRlbCA9IEBQUlxyXG5cdFx0XHRwZXJmID0gcGVyZm9ybWFuY2UgYW5kZWwsIEBlbG9zXHJcblx0XHRcdEBQUiA9IHBlcmZcclxuXHJcblx0XHRlY2hvICdBJywgQG5hbWUsIEBlbG8sIEBQLnRvRml4ZWQoMyksIEBQUiAjLCBnbG9iYWwuYXZlcmFnZVxyXG5cdFx0QFEgPSBzZXR0aW5ncy5HQU1FUyAqIHNldHRpbmdzLlJPVU5EUyAqIGVsb19mb3JtdWxhIGdsb2JhbC5hdmVyYWdlIC0gQFBSXHJcblx0XHQjIGVjaG8gJ0InLCBAZWxvLCBzZXR0aW5ncy5HQU1FUyAqIHNldHRpbmdzLlJPVU5EUywgQFEsIGVsb19mb3JtdWxhIGdsb2JhbC5hdmVyYWdlIC0gQFBSXHJcblxyXG4iXX0=
//# sourceURL=c:\github\2025\035-FairPair\player.coffee