// Generated by CoffeeScript 2.7.0
var echo, expected_score, extrapolate, performance_rating, summa;

echo = console.log;

export var elo_formula = function(gap) {
  return 1 / (1 + 10 ** (gap / 400));
};

expected_score = function(ratings, own_rating) {
  var rating;
  return summa((function() {
    var i, len, results;
    results = [];
    for (i = 0, len = ratings.length; i < len; i++) {
      rating = ratings[i];
      results.push(1 / (1 + 10 ** ((rating - own_rating) / 400)));
    }
    return results;
  })());
};

// Use two extreme values when calculating 0% or 100%
extrapolate = function(a0, b0, elos) {
  var a, b;
  a = performance_rating(a0, elos);
  b = performance_rating(b0, elos);
  return b + b - a;
};

export var performance = function(pp, elos) {
  var n;
  n = elos.length;
  if (pp === 0) {
    return extrapolate(0.5, 0.25, elos);
  }
  if (pp === n) {
    return extrapolate(n - 0.5, n - 0.25, elos);
  }
  return performance_rating(pp, elos);
};

// export performance = (pp,elos) -> 
// 	n = elos.length
// 	if n == 1
// 		if pp == 0 then return extrapolate 0.50,0.25,elos
// 		if pp == n then return extrapolate 0.50,0.75,elos
// 	else
// 		if pp == 0 then return extrapolate   1,  0.5,elos
// 		if pp == n then return extrapolate n-1,n-0.5,elos
// 	performance_rating pp,elos
performance_rating = function(pp, ratings) {
  var hi, lo, rating;
  lo = 0;
  hi = 4000;
  while (Math.abs(hi - lo) > 0.001) {
    rating = (lo + hi) / 2;
    if (pp > expected_score(ratings, rating)) {
      lo = rating;
    } else {
      hi = rating;
    }
  }
  //echo 'performance_rating', pp, ratings,rating
  return rating;
};

summa = function(arr) {
  var i, item, len, res;
  res = 0;
  for (i = 0, len = arr.length; i < len; i++) {
    item = arr[i];
    res += item;
  }
  return res;
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmF0aW5nLmpzIiwic291cmNlUm9vdCI6IlxcIiwic291cmNlcyI6WyJyYXRpbmcuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFBLElBQUEsRUFBQSxjQUFBLEVBQUEsV0FBQSxFQUFBLGtCQUFBLEVBQUE7O0FBQUEsSUFBQSxHQUFPLE9BQU8sQ0FBQzs7QUFFZixPQUFBLElBQU8sV0FBQSxHQUFjLFFBQUEsQ0FBQyxHQUFELENBQUE7U0FBUyxDQUFBLEdBQUksQ0FBQyxDQUFBLEdBQUksRUFBQSxJQUFJLENBQUUsR0FBRCxHQUFRLEdBQVQsQ0FBVDtBQUFiOztBQUVyQixjQUFBLEdBQWlCLFFBQUEsQ0FBQyxPQUFELEVBQVUsVUFBVixDQUFBO0FBQXdCLE1BQUE7U0FBQyxLQUFBOztBQUFPO0lBQUEsS0FBQSx5Q0FBQTs7bUJBQUEsQ0FBQSxHQUFJLENBQUMsQ0FBQSxHQUFJLEVBQUEsSUFBSSxDQUFDLENBQUMsTUFBQSxHQUFTLFVBQVYsQ0FBQSxHQUF3QixHQUF6QixDQUFUO0lBQUosQ0FBQTs7TUFBUDtBQUF6QixFQUpqQjs7O0FBT0EsV0FBQSxHQUFjLFFBQUEsQ0FBQyxFQUFELEVBQUssRUFBTCxFQUFTLElBQVQsQ0FBQTtBQUNkLE1BQUEsQ0FBQSxFQUFBO0VBQUMsQ0FBQSxHQUFJLGtCQUFBLENBQW1CLEVBQW5CLEVBQXNCLElBQXRCO0VBQ0osQ0FBQSxHQUFJLGtCQUFBLENBQW1CLEVBQW5CLEVBQXNCLElBQXRCO1NBQ0osQ0FBQSxHQUFJLENBQUosR0FBUTtBQUhLOztBQUtkLE9BQUEsSUFBTyxXQUFBLEdBQWMsUUFBQSxDQUFDLEVBQUQsRUFBSSxJQUFKLENBQUE7QUFDckIsTUFBQTtFQUFDLENBQUEsR0FBSSxJQUFJLENBQUM7RUFDVCxJQUFHLEVBQUEsS0FBTSxDQUFUO0FBQWdCLFdBQU8sV0FBQSxDQUFjLEdBQWQsRUFBb0IsSUFBcEIsRUFBeUIsSUFBekIsRUFBdkI7O0VBQ0EsSUFBRyxFQUFBLEtBQU0sQ0FBVDtBQUFnQixXQUFPLFdBQUEsQ0FBWSxDQUFBLEdBQUUsR0FBZCxFQUFrQixDQUFBLEdBQUUsSUFBcEIsRUFBeUIsSUFBekIsRUFBdkI7O1NBQ0Esa0JBQUEsQ0FBbUIsRUFBbkIsRUFBc0IsSUFBdEI7QUFKb0IsRUFackI7Ozs7Ozs7Ozs7O0FBNEJBLGtCQUFBLEdBQXFCLFFBQUEsQ0FBQyxFQUFELEVBQUssT0FBTCxDQUFBO0FBQ3JCLE1BQUEsRUFBQSxFQUFBLEVBQUEsRUFBQTtFQUFDLEVBQUEsR0FBSztFQUNMLEVBQUEsR0FBSztBQUNMLFNBQU0sSUFBSSxDQUFDLEdBQUwsQ0FBUyxFQUFBLEdBQUssRUFBZCxDQUFBLEdBQW9CLEtBQTFCO0lBQ0MsTUFBQSxHQUFTLENBQUMsRUFBQSxHQUFLLEVBQU4sQ0FBQSxHQUFZO0lBQ3JCLElBQUcsRUFBQSxHQUFLLGNBQUEsQ0FBZSxPQUFmLEVBQXdCLE1BQXhCLENBQVI7TUFDQyxFQUFBLEdBQUssT0FETjtLQUFBLE1BQUE7TUFHQyxFQUFBLEdBQUssT0FITjs7RUFGRCxDQUZEOztTQVNDO0FBVm9COztBQVlyQixLQUFBLEdBQVEsUUFBQSxDQUFDLEdBQUQsQ0FBQTtBQUNSLE1BQUEsQ0FBQSxFQUFBLElBQUEsRUFBQSxHQUFBLEVBQUE7RUFBQyxHQUFBLEdBQU07RUFDTixLQUFBLHFDQUFBOztJQUNDLEdBQUEsSUFBTztFQURSO1NBRUE7QUFKTyIsInNvdXJjZXNDb250ZW50IjpbImVjaG8gPSBjb25zb2xlLmxvZyBcclxuXHJcbmV4cG9ydCBlbG9fZm9ybXVsYSA9IChnYXApIC0+IDEgLyAoMSArIDEwKiooKGdhcCkgLyA0MDApKVxyXG5cclxuZXhwZWN0ZWRfc2NvcmUgPSAocmF0aW5ncywgb3duX3JhdGluZykgLT4gc3VtbWEgKDEgLyAoMSArIDEwKiooKHJhdGluZyAtIG93bl9yYXRpbmcpIC8gNDAwKSkgZm9yIHJhdGluZyBpbiByYXRpbmdzKVxyXG5cclxuIyBVc2UgdHdvIGV4dHJlbWUgdmFsdWVzIHdoZW4gY2FsY3VsYXRpbmcgMCUgb3IgMTAwJVxyXG5leHRyYXBvbGF0ZSA9IChhMCwgYjAsIGVsb3MpIC0+XHJcblx0YSA9IHBlcmZvcm1hbmNlX3JhdGluZyBhMCxlbG9zXHJcblx0YiA9IHBlcmZvcm1hbmNlX3JhdGluZyBiMCxlbG9zXHJcblx0YiArIGIgLSBhXHJcblxyXG5leHBvcnQgcGVyZm9ybWFuY2UgPSAocHAsZWxvcykgLT4gXHJcblx0biA9IGVsb3MubGVuZ3RoXHJcblx0aWYgcHAgPT0gMCB0aGVuIHJldHVybiBleHRyYXBvbGF0ZSAgIDAuNSwgIDAuMjUsZWxvc1xyXG5cdGlmIHBwID09IG4gdGhlbiByZXR1cm4gZXh0cmFwb2xhdGUgbi0wLjUsbi0wLjI1LGVsb3NcclxuXHRwZXJmb3JtYW5jZV9yYXRpbmcgcHAsZWxvc1xyXG5cclxuIyBleHBvcnQgcGVyZm9ybWFuY2UgPSAocHAsZWxvcykgLT4gXHJcbiMgXHRuID0gZWxvcy5sZW5ndGhcclxuIyBcdGlmIG4gPT0gMVxyXG4jIFx0XHRpZiBwcCA9PSAwIHRoZW4gcmV0dXJuIGV4dHJhcG9sYXRlIDAuNTAsMC4yNSxlbG9zXHJcbiMgXHRcdGlmIHBwID09IG4gdGhlbiByZXR1cm4gZXh0cmFwb2xhdGUgMC41MCwwLjc1LGVsb3NcclxuIyBcdGVsc2VcclxuIyBcdFx0aWYgcHAgPT0gMCB0aGVuIHJldHVybiBleHRyYXBvbGF0ZSAgIDEsICAwLjUsZWxvc1xyXG4jIFx0XHRpZiBwcCA9PSBuIHRoZW4gcmV0dXJuIGV4dHJhcG9sYXRlIG4tMSxuLTAuNSxlbG9zXHJcbiMgXHRwZXJmb3JtYW5jZV9yYXRpbmcgcHAsZWxvc1xyXG5cclxucGVyZm9ybWFuY2VfcmF0aW5nID0gKHBwLCByYXRpbmdzKSAtPlxyXG5cdGxvID0gMFxyXG5cdGhpID0gNDAwMFxyXG5cdHdoaWxlIE1hdGguYWJzKGhpIC0gbG8pID4gMC4wMDFcclxuXHRcdHJhdGluZyA9IChsbyArIGhpKSAvIDJcclxuXHRcdGlmIHBwID4gZXhwZWN0ZWRfc2NvcmUgcmF0aW5ncywgcmF0aW5nXHJcblx0XHRcdGxvID0gcmF0aW5nXHJcblx0XHRlbHNlXHJcblx0XHRcdGhpID0gcmF0aW5nXHJcblx0I2VjaG8gJ3BlcmZvcm1hbmNlX3JhdGluZycsIHBwLCByYXRpbmdzLHJhdGluZ1xyXG5cdHJhdGluZ1xyXG5cclxuc3VtbWEgPSAoYXJyKSAtPlxyXG5cdHJlcyA9IDBcclxuXHRmb3IgaXRlbSBpbiBhcnJcclxuXHRcdHJlcyArPSBpdGVtXHJcblx0cmVzXHJcbiJdfQ==
//# sourceURL=c:\github\2025\035-FairPair\rating.coffee