// Generated by CoffeeScript 2.7.0
var echo, exec, expected_score, extrapolate, inv, performance_rating, summa;

echo = console.log;

export var elo_formula = function(gap) {
  return 1 / (1 + 10 ** (gap / 400));
};

// expected_score = (ratings, own_rating) -> summa ((elo_formula own_rating - rating) for rating in ratings)
expected_score = function(ratings, own_rating) {
  var rating;
  return summa((function() {
    var j, len, results;
    results = [];
    for (j = 0, len = ratings.length; j < len; j++) {
      rating = ratings[j];
      results.push(1 / (1 + 10 ** ((rating - own_rating) / 400)));
    }
    return results;
  })());
};

// Use two extreme values when calculating 0% or 100%
extrapolate = function(a0, b0, elos) {
  var a, b;
  a = performance_rating(a0, elos);
  b = performance_rating(b0, elos);
  return b + b - a;
};

export var performance = function(pp, elos) {
  var n;
  n = elos.length;
  if (pp === 0) {
    return extrapolate(0.5, 0.25, elos);
  }
  if (pp === n) {
    return extrapolate(n - 0.5, n - 0.25, elos);
  }
  return performance_rating(pp, elos);
};

performance_rating = function(pp, ratings) {
  var hi, lo, rating;
  lo = 0;
  hi = 4000;
  while (Math.abs(hi - lo) > 0.001) {
    rating = (lo + hi) / 2;
    if (pp > expected_score(ratings, rating)) {
      lo = rating;
    } else {
      hi = rating;
    }
  }
  return rating;
};

summa = function(arr) {
  var item, j, len, res;
  res = 0;
  for (j = 0, len = arr.length; j < len; j++) {
    item = arr[j];
    res += item;
  }
  return res;
};

inv = function(score) {
  var gap, hi, lo;
  lo = -1000;
  hi = 1000;
  while (Math.abs(hi - lo) > 0.001) {
    gap = (lo + hi) / 2;
    if (score > elo_formula(gap)) {
      lo = gap;
    } else {
      hi = gap;
    }
  }
  return gap;
};

//###

// echo performance_rating 2, [2113,1986,2132,2057,1702,2085] # Rånby
// echo elo_formula -100
// echo elo_formula 100

// for x in [-200,-100,0,100,200]
// 	echo x,elo_formula x

// echo inv 0.36
// echo inv 0.64

// for i in _.range -1000,1000,100
// 	echo i,elo_formula i
echo("");

// for i in [0.01,0.1,0.2,0.3,0.4,0.5, 0.6, 0.7, 0.8, 0.9, 0.99]
// 	echo i,inv i

//rånby = [2113,1986,2132,2057,1702,2085]

//echo expected_score rånby, 1900 # 3.8839
//echo performance_rating 3.8839, rånby # 1900.000

// average är en grövre metod. Undvik om möjligt.
// avg = summa(rånby)/6
// echo avg
// echo 6 * elo_formula avg - 1900 # 3.9388
// echo performance_rating 3.9388, rånby # 1891.685
exec = function(name, elo, elos, score, n) {
  var b, i, j, len, ref;
  ref = _.range(n - elos.length);
  for (j = 0, len = ref.length; j < len; j++) {
    i = ref[j];
    elos.push(elo);
  }
  b = performance(score, elos);
  return echo(name, score, b.toFixed(0));
};

//   QR Q 
exec("Silins ", 1800, [1613, 1679, 1799], 3, 3); // 2268 3.00

exec("Razavi ", 1799, [1679, 1650, 1800], 2, 3); // 1834 2.00

exec("Nilsson", 1650, [1607, 1799, 1679], 2, 3); // 1821 1.97

exec("Gordh  ", 1570, [1613, 1513], 2, 3); // 1687 1.67

exec("Eldin  ", 1476, [1513], 1, 3); // 1368 0.93

exec("Johanss", 1679, [1799, 1800, 1650], 0, 3); // 1181 0.50

exec("Steiner", 1613, [1800, 1570], 0, 3); // 1083 0.28

exec("Franzon", 1607, [1650], 0, 3); // 1067 0.24

exec("Granath", 1513, [1476, 1570], 0, 3); //  962 0.00

/*

1. Tag bort frironder, w.o. och ospelat. Sällan detta inträffar.
2. Lägg på EGET elo så alla har lika många elos. När det inträffar => "remi"
3. Beräkna performance
4. Linjärtransformera QR => Q
   Punkterna ovan, (3,2268) samt (0,962) används för att skapa denna linje.

*/

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmF0aW5nLmpzIiwic291cmNlUm9vdCI6IlxcIiwic291cmNlcyI6WyJyYXRpbmcuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsY0FBQSxFQUFBLFdBQUEsRUFBQSxHQUFBLEVBQUEsa0JBQUEsRUFBQTs7QUFBQSxJQUFBLEdBQU8sT0FBTyxDQUFDOztBQUVmLE9BQUEsSUFBTyxXQUFBLEdBQWMsUUFBQSxDQUFDLEdBQUQsQ0FBQTtTQUFTLENBQUEsR0FBSSxDQUFDLENBQUEsR0FBSSxFQUFBLElBQU0sQ0FBQyxHQUFBLEdBQU0sR0FBUCxDQUFYO0FBQWIsRUFGckI7OztBQUtBLGNBQUEsR0FBaUIsUUFBQSxDQUFDLE9BQUQsRUFBVSxVQUFWLENBQUE7QUFBd0IsTUFBQTtTQUFDLEtBQUE7O0FBQU87SUFBQSxLQUFBLHlDQUFBOzttQkFBQSxDQUFBLEdBQUksQ0FBQyxDQUFBLEdBQUksRUFBQSxJQUFJLENBQUMsQ0FBQyxNQUFBLEdBQVMsVUFBVixDQUFBLEdBQXdCLEdBQXpCLENBQVQ7SUFBSixDQUFBOztNQUFQO0FBQXpCLEVBTGpCOzs7QUFTQSxXQUFBLEdBQWMsUUFBQSxDQUFDLEVBQUQsRUFBSyxFQUFMLEVBQVMsSUFBVCxDQUFBO0FBQ2QsTUFBQSxDQUFBLEVBQUE7RUFBQyxDQUFBLEdBQUksa0JBQUEsQ0FBbUIsRUFBbkIsRUFBc0IsSUFBdEI7RUFDSixDQUFBLEdBQUksa0JBQUEsQ0FBbUIsRUFBbkIsRUFBc0IsSUFBdEI7U0FDSixDQUFBLEdBQUksQ0FBSixHQUFRO0FBSEs7O0FBS2QsT0FBQSxJQUFPLFdBQUEsR0FBYyxRQUFBLENBQUMsRUFBRCxFQUFJLElBQUosQ0FBQTtBQUNyQixNQUFBO0VBQUMsQ0FBQSxHQUFJLElBQUksQ0FBQztFQUNULElBQUcsRUFBQSxLQUFNLENBQVQ7QUFBZ0IsV0FBTyxXQUFBLENBQWMsR0FBZCxFQUFvQixJQUFwQixFQUF5QixJQUF6QixFQUF2Qjs7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QTs7QUEwRkEsSUFBQSxDQUFLLFNBQUwsRUFBZ0IsSUFBaEIsRUFBc0IsQ0FBQyxJQUFELEVBQU0sSUFBTixFQUFXLElBQVgsQ0FBdEIsRUFBd0MsQ0FBeEMsRUFBMkMsQ0FBM0MsRUExRkE7O0FBMkZBLElBQUEsQ0FBSyxTQUFMLEVBQWdCLElBQWhCLEVBQXNCLENBQUMsSUFBRCxFQUFNLElBQU4sQ0FBdEIsRUFBd0MsQ0FBeEMsRUFBMkMsQ0FBM0MsRUEzRkE7O0FBNEZBLElBQUEsQ0FBSyxTQUFMLEVBQWdCLElBQWhCLEVBQXNCLENBQUMsSUFBRCxDQUF0QixFQUF3QyxDQUF4QyxFQUEyQyxDQUEzQyxFQTVGQTs7QUE2RkEsSUFBQSxDQUFLLFNBQUwsRUFBZ0IsSUFBaEIsRUFBc0IsQ0FBQyxJQUFELEVBQU0sSUFBTixDQUF0QixFQUF3QyxDQUF4QyxFQUEyQyxDQUEzQyxFQTdGQTs7QUFBQSIsInNvdXJjZXNDb250ZW50IjpbImVjaG8gPSBjb25zb2xlLmxvZyBcclxuXHJcbmV4cG9ydCBlbG9fZm9ybXVsYSA9IChnYXApIC0+IDEgLyAoMSArIDEwICoqIChnYXAgLyA0MDApKVxyXG5cclxuIyBleHBlY3RlZF9zY29yZSA9IChyYXRpbmdzLCBvd25fcmF0aW5nKSAtPiBzdW1tYSAoKGVsb19mb3JtdWxhIG93bl9yYXRpbmcgLSByYXRpbmcpIGZvciByYXRpbmcgaW4gcmF0aW5ncylcclxuZXhwZWN0ZWRfc2NvcmUgPSAocmF0aW5ncywgb3duX3JhdGluZykgLT4gc3VtbWEgKDEgLyAoMSArIDEwKiooKHJhdGluZyAtIG93bl9yYXRpbmcpIC8gNDAwKSkgZm9yIHJhdGluZyBpbiByYXRpbmdzKVxyXG5cclxuXHJcbiMgVXNlIHR3byBleHRyZW1lIHZhbHVlcyB3aGVuIGNhbGN1bGF0aW5nIDAlIG9yIDEwMCVcclxuZXh0cmFwb2xhdGUgPSAoYTAsIGIwLCBlbG9zKSAtPlxyXG5cdGEgPSBwZXJmb3JtYW5jZV9yYXRpbmcgYTAsZWxvc1xyXG5cdGIgPSBwZXJmb3JtYW5jZV9yYXRpbmcgYjAsZWxvc1xyXG5cdGIgKyBiIC0gYVxyXG5cclxuZXhwb3J0IHBlcmZvcm1hbmNlID0gKHBwLGVsb3MpIC0+IFxyXG5cdG4gPSBlbG9zLmxlbmd0aFxyXG5cdGlmIHBwID09IDAgdGhlbiByZXR1cm4gZXh0cmFwb2xhdGUgICAwLjUsICAwLjI1LGVsb3NcclxuXHRpZiBwcCA9PSBuIHRoZW4gcmV0dXJuIGV4dHJhcG9sYXRlIG4tMC41LG4tMC4yNSxlbG9zXHJcblx0cGVyZm9ybWFuY2VfcmF0aW5nIHBwLGVsb3NcclxuXHJcbnBlcmZvcm1hbmNlX3JhdGluZyA9IChwcCwgcmF0aW5ncykgLT5cclxuXHRsbyA9IDBcclxuXHRoaSA9IDQwMDBcclxuXHR3aGlsZSBNYXRoLmFicyhoaSAtIGxvKSA+IDAuMDAxXHJcblx0XHRyYXRpbmcgPSAobG8gKyBoaSkgLyAyXHJcblx0XHRpZiBwcCA+IGV4cGVjdGVkX3Njb3JlIHJhdGluZ3MsIHJhdGluZ1xyXG5cdFx0XHRsbyA9IHJhdGluZ1xyXG5cdFx0ZWxzZVxyXG5cdFx0XHRoaSA9IHJhdGluZ1xyXG5cdHJhdGluZ1xyXG5cclxuc3VtbWEgPSAoYXJyKSAtPlxyXG5cdHJlcyA9IDBcclxuXHRmb3IgaXRlbSBpbiBhcnJcclxuXHRcdHJlcyArPSBpdGVtXHJcblx0cmVzXHJcblxyXG5pbnYgPSAoc2NvcmUpIC0+XHJcblx0bG8gPSAtMTAwMFxyXG5cdGhpID0gMTAwMFxyXG5cdHdoaWxlIE1hdGguYWJzKGhpIC0gbG8pID4gMC4wMDFcclxuXHRcdGdhcCA9IChsbyArIGhpKSAvIDJcclxuXHRcdGlmIHNjb3JlID4gZWxvX2Zvcm11bGEgZ2FwXHJcblx0XHRcdGxvID0gZ2FwXHJcblx0XHRlbHNlXHJcblx0XHRcdGhpID0gZ2FwXHJcblx0Z2FwXHJcblxyXG4jIyMjXHJcblxyXG4jIGVjaG8gcGVyZm9ybWFuY2VfcmF0aW5nIDIsIFsyMTEzLDE5ODYsMjEzMiwyMDU3LDE3MDIsMjA4NV0gIyBSw6VuYnlcclxuIyBlY2hvIGVsb19mb3JtdWxhIC0xMDBcclxuIyBlY2hvIGVsb19mb3JtdWxhIDEwMFxyXG5cclxuIyBmb3IgeCBpbiBbLTIwMCwtMTAwLDAsMTAwLDIwMF1cclxuIyBcdGVjaG8geCxlbG9fZm9ybXVsYSB4XHJcblxyXG4jIGVjaG8gaW52IDAuMzZcclxuIyBlY2hvIGludiAwLjY0XHJcblxyXG4jIGZvciBpIGluIF8ucmFuZ2UgLTEwMDAsMTAwMCwxMDBcclxuIyBcdGVjaG8gaSxlbG9fZm9ybXVsYSBpXHJcblxyXG5lY2hvIFwiXCJcclxuXHJcbiMgZm9yIGkgaW4gWzAuMDEsMC4xLDAuMiwwLjMsMC40LDAuNSwgMC42LCAwLjcsIDAuOCwgMC45LCAwLjk5XVxyXG4jIFx0ZWNobyBpLGludiBpXHJcblxyXG4jcsOlbmJ5ID0gWzIxMTMsMTk4NiwyMTMyLDIwNTcsMTcwMiwyMDg1XVxyXG5cclxuI2VjaG8gZXhwZWN0ZWRfc2NvcmUgcsOlbmJ5LCAxOTAwICMgMy44ODM5XHJcbiNlY2hvIHBlcmZvcm1hbmNlX3JhdGluZyAzLjg4MzksIHLDpW5ieSAjIDE5MDAuMDAwXHJcblxyXG4jIGF2ZXJhZ2Ugw6RyIGVuIGdyw7Z2cmUgbWV0b2QuIFVuZHZpayBvbSBtw7ZqbGlndC5cclxuIyBhdmcgPSBzdW1tYShyw6VuYnkpLzZcclxuIyBlY2hvIGF2Z1xyXG4jIGVjaG8gNiAqIGVsb19mb3JtdWxhIGF2ZyAtIDE5MDAgIyAzLjkzODhcclxuIyBlY2hvIHBlcmZvcm1hbmNlX3JhdGluZyAzLjkzODgsIHLDpW5ieSAjIDE4OTEuNjg1XHJcblxyXG5leGVjID0gKG5hbWUsZWxvLGVsb3Msc2NvcmUsbikgLT5cclxuXHRmb3IgaSBpbiBfLnJhbmdlIG4gLSBlbG9zLmxlbmd0aFxyXG5cdFx0ZWxvcy5wdXNoIGVsb1xyXG5cdGIgPSBwZXJmb3JtYW5jZSBzY29yZSwgZWxvc1xyXG5cdGVjaG8gbmFtZSwgc2NvcmUsIGIudG9GaXhlZCAwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgICBRUiBRIFxyXG5leGVjIFwiU2lsaW5zIFwiLCAxODAwLCBbMTYxMywxNjc5LDE3OTldLCAzLCAzICMgMjI2OCAzLjAwXHJcbmV4ZWMgXCJSYXphdmkgXCIsXHQxNzk5LCBbMTY3OSwxNjUwLDE4MDBdLCAyLCAzICMgMTgzNCAyLjAwXHJcbmV4ZWMgXCJOaWxzc29uXCIsXHQxNjUwLCBbMTYwNywxNzk5LDE2NzldLCAyLCAzICMgMTgyMSAxLjk3XHJcbmV4ZWMgXCJHb3JkaCAgXCIsXHQxNTcwLCBbMTYxMywxNTEzICAgICBdLCAyLCAzICMgMTY4NyAxLjY3XHJcbmV4ZWMgXCJFbGRpbiAgXCIsXHQxNDc2LCBbMTUxMyAgICAgICAgICBdLCAxLCAzICMgMTM2OCAwLjkzXHJcbmV4ZWMgXCJKb2hhbnNzXCIsIDE2NzksIFsxNzk5LDE4MDAsMTY1MF0sIDAsIDMgIyAxMTgxIDAuNTBcclxuZXhlYyBcIlN0ZWluZXJcIixcdDE2MTMsIFsxODAwLDE1NzAgICAgIF0sIDAsIDMgIyAxMDgzIDAuMjhcclxuZXhlYyBcIkZyYW56b25cIixcdDE2MDcsIFsxNjUwICAgICAgICAgIF0sIDAsIDMgIyAxMDY3IDAuMjRcclxuZXhlYyBcIkdyYW5hdGhcIixcdDE1MTMsIFsxNDc2LDE1NzAgICAgIF0sIDAsIDMgIyAgOTYyIDAuMDBcclxuXHJcbiMjI1xyXG5cclxuMS4gVGFnIGJvcnQgZnJpcm9uZGVyLCB3Lm8uIG9jaCBvc3BlbGF0LiBTw6RsbGFuIGRldHRhIGludHLDpGZmYXIuXHJcbjIuIEzDpGdnIHDDpSBFR0VUIGVsbyBzw6UgYWxsYSBoYXIgbGlrYSBtw6VuZ2EgZWxvcy4gTsOkciBkZXQgaW50csOkZmZhciA9PiBcInJlbWlcIlxyXG4zLiBCZXLDpGtuYSBwZXJmb3JtYW5jZVxyXG40LiBMaW5qw6RydHJhbnNmb3JtZXJhIFFSID0+IFFcclxuICAgUHVua3Rlcm5hIG92YW4sICgzLDIyNjgpIHNhbXQgKDAsOTYyKSBhbnbDpG5kcyBmw7ZyIGF0dCBza2FwYSBkZW5uYSBsaW5qZS5cclxuXHJcbiMjIyJdfQ==
//# sourceURL=c:\github\2025\035-FairPair\rating.coffee